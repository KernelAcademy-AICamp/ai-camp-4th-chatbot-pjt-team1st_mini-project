"""
ğŸ“š artifacts.py - ìœ ë¬¼ ë°ì´í„°
==============================

ìœ ë¬¼ ì •ë³´ë¥¼ ì¶”ê°€/ìˆ˜ì •í•˜ëŠ” íŒŒì¼ì…ë‹ˆë‹¤.
êµ­ë¦½ì¤‘ì•™ë°•ë¬¼ê´€ API ì—°ë™ ë˜ëŠ” í•˜ë“œì½”ë”© ë°ì´í„° ì‚¬ìš©
"""

import os
import random


# ============================================================
# ğŸŒ APIì—ì„œ ìœ ë¬¼ ê°€ì ¸ì˜¤ê¸°
# ============================================================

def fetch_artifacts_from_api(count: int = 10) -> list:
    """
    êµ­ë¦½ì¤‘ì•™ë°•ë¬¼ê´€ APIì—ì„œ ìœ ë¬¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°

    Returns:
        list: ìœ ë¬¼ ëª©ë¡ (API ì‹¤íŒ¨ ì‹œ ë¹ˆ ë¦¬ìŠ¤íŠ¸)
    """
    try:
        from services.museum_api import get_museum_service

        service = get_museum_service()
        if not service.service_key:
            print("âš ï¸ MUSEUM_API_KEYê°€ ì—†ì–´ì„œ ê¸°ë³¸ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.")
            return []

        artifacts = service.get_random_artifacts(count=count)
        if artifacts:
            print(f"âœ… APIì—ì„œ {len(artifacts)}ê°œ ìœ ë¬¼ ë¡œë“œ ì™„ë£Œ")
            return artifacts

    except Exception as e:
        print(f"âš ï¸ API ë¡œë“œ ì‹¤íŒ¨: {e}")

    return []


# ============================================================
# ğŸ“œ í•˜ë“œì½”ë”©ëœ ìœ ë¬¼ ë°ì´í„°ë² ì´ìŠ¤ (15ê°œ) - í´ë°±ìš©
# ============================================================

ARTIFACTS = {
    "ê¸ˆë™ë¯¸ë¥µë³´ì‚´ë°˜ê°€ì‚¬ìœ ìƒ": {
        "id": "NMK-001",
        "name": "ê¸ˆë™ë¯¸ë¥µë³´ì‚´ë°˜ê°€ì‚¬ìœ ìƒ",
        "period": "ì‚¼êµ­ì‹œëŒ€ (6-7ì„¸ê¸°)",
        "material": "ê¸ˆë™ (ì²­ë™ì— ê¸ˆë„ê¸ˆ)",
        "location": "êµ­ë¦½ì¤‘ì•™ë°•ë¬¼ê´€",
        "designation": "êµ­ë³´ ì œ83í˜¸",
        "description": "í•œìª½ ë‹¤ë¦¬ë¥¼ ë‹¤ë¥¸ ìª½ ë¬´ë¦ ìœ„ì— ì˜¬ë¦¬ê³ , ì†ê°€ë½ì„ ëº¨ì— ëŒ„ ì±„ ê¹Šì€ ìƒê°ì— ì ê¸´ ëª¨ìŠµì˜ ë³´ì‚´ìƒì…ë‹ˆë‹¤. ì‚¼êµ­ì‹œëŒ€ ë¶ˆêµ ì¡°ê°ì˜ ìµœê³  ê±¸ì‘ìœ¼ë¡œ í‰ê°€ë°›ìŠµë‹ˆë‹¤.",
        "quiz": {
            "question": "ê¸ˆë™ë¯¸ë¥µë³´ì‚´ë°˜ê°€ì‚¬ìœ ìƒì˜ 'ë°˜ê°€ì‚¬ìœ 'ëŠ” ì–´ë–¤ ìì„¸ë¥¼ ì˜ë¯¸í• ê¹Œìš”?",
            "options": ["ë‘ ì†ì„ ëª¨ì•„ ê¸°ë„í•˜ëŠ” ìì„¸", "í•œìª½ ë‹¤ë¦¬ë¥¼ ì˜¬ë¦¬ê³  ìƒê°í•˜ëŠ” ìì„¸", "ëˆ„ì›Œì„œ ëª…ìƒí•˜ëŠ” ìì„¸", "ì„œì„œ ì„¤ë²•í•˜ëŠ” ìì„¸"],
            "answer": 1,
            "explanation": "ë°˜ê°€ì‚¬ìœ ëŠ” í•œìª½ ë‹¤ë¦¬ë¥¼ ë‹¤ë¥¸ ìª½ ë¬´ë¦ ìœ„ì— ì˜¬ë¦¬ê³  ì†ê°€ë½ì„ ëº¨ì— ëŒ„ ì±„ ê¹Šì€ ìƒê°ì— ì ê¸´ ìì„¸ë¥¼ ë§í•©ë‹ˆë‹¤."
        }
    },

    "ë°±ì œê¸ˆë™ëŒ€í–¥ë¡œ": {
        "id": "NMK-002",
        "name": "ë°±ì œê¸ˆë™ëŒ€í–¥ë¡œ",
        "period": "ë°±ì œ (6-7ì„¸ê¸°)",
        "material": "ê¸ˆë™",
        "location": "êµ­ë¦½ë¶€ì—¬ë°•ë¬¼ê´€",
        "designation": "êµ­ë³´ ì œ287í˜¸",
        "description": "ë°±ì œì˜ ë›°ì–´ë‚œ ê¸ˆì† ê³µì˜ˆ ê¸°ìˆ ì„ ë³´ì—¬ì£¼ëŠ” ëŒ€í‘œì ì¸ ìœ ë¬¼ì…ë‹ˆë‹¤. ìš©ì´ ì—°ê½ƒì„ ë¬¼ê³  ìˆëŠ” ë°›ì¹¨ëŒ€ ìœ„ì— ì‚°ì•…ì„ í˜•ìƒí™”í•œ ëšœê»‘ì´ ì˜¬ë ¤ì ¸ ìˆìŠµë‹ˆë‹¤.",
        "quiz": {
            "question": "ë°±ì œê¸ˆë™ëŒ€í–¥ë¡œì˜ ëšœê»‘ ê¼­ëŒ€ê¸°ì—ëŠ” ì–´ë–¤ ë™ë¬¼ì´ ìˆì„ê¹Œìš”?",
            "options": ["ìš©", "ë´‰í™©", "ê±°ë¶ì´", "í˜¸ë‘ì´"],
            "answer": 1,
            "explanation": "ë°±ì œê¸ˆë™ëŒ€í–¥ë¡œì˜ ëšœê»‘ ê¼­ëŒ€ê¸°ì—ëŠ” ë´‰í™©ì´ ìˆìœ¼ë©°, ë°›ì¹¨ëŒ€ì—ëŠ” ìš©ì´ ì—°ê½ƒì„ ë¬¼ê³  ìˆìŠµë‹ˆë‹¤."
        }
    },

    "ì‹ ë¼ê¸ˆê´€": {
        "id": "NMK-003",
        "name": "ì‹ ë¼ ê¸ˆê´€",
        "period": "ì‹ ë¼ (5-6ì„¸ê¸°)",
        "material": "ê¸ˆ, ì˜¥",
        "location": "êµ­ë¦½ì¤‘ì•™ë°•ë¬¼ê´€",
        "designation": "êµ­ë³´ ì œ87í˜¸",
        "description": "ì‹ ë¼ ì™•ì¡±ì˜ ê¶Œìœ„ë¥¼ ìƒì§•í•˜ëŠ” ê¸ˆê´€ì…ë‹ˆë‹¤. ë‚˜ë­‡ê°€ì§€ ëª¨ì–‘(å‡ºìí˜•)ê³¼ ì‚¬ìŠ´ë¿” ëª¨ì–‘ì˜ ì„¸ì›€ ì¥ì‹ì´ íŠ¹ì§•ì…ë‹ˆë‹¤.",
        "quiz": {
            "question": "ì‹ ë¼ ê¸ˆê´€ì˜ ì„¸ì›€ ì¥ì‹ì€ ì–´ë–¤ ëª¨ì–‘ì„ í•˜ê³  ìˆì„ê¹Œìš”?",
            "options": ["ê½ƒê³¼ ë‚˜ë¹„ ëª¨ì–‘", "ë‚˜ë­‡ê°€ì§€ì™€ ì‚¬ìŠ´ë¿” ëª¨ì–‘", "êµ¬ë¦„ê³¼ ë‹¬ ëª¨ì–‘", "íŒŒë„ì™€ ë¬¼ê³ ê¸° ëª¨ì–‘"],
            "answer": 1,
            "explanation": "ì‹ ë¼ ê¸ˆê´€ì€ ë‚˜ë­‡ê°€ì§€ ëª¨ì–‘(å‡ºìí˜•)ê³¼ ì‚¬ìŠ´ë¿” ëª¨ì–‘ì˜ ì„¸ì›€ ì¥ì‹ì´ íŠ¹ì§•ì´ë©°, ì´ëŠ” í•˜ëŠ˜ê³¼ ë•…ì„ ì—°ê²°í•˜ëŠ” ì˜ë¯¸ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤."
        }
    },

    "ì²­ììƒê°ìš´í•™ë¬¸ë§¤ë³‘": {
        "id": "NMK-004",
        "name": "ì²­ì ìƒê°ìš´í•™ë¬¸ ë§¤ë³‘",
        "period": "ê³ ë ¤ (12ì„¸ê¸°)",
        "material": "ì²­ì",
        "location": "êµ­ë¦½ì¤‘ì•™ë°•ë¬¼ê´€",
        "designation": "êµ­ë³´ ì œ68í˜¸",
        "description": "ê³ ë ¤ì‹œëŒ€ë¥¼ ëŒ€í‘œí•˜ëŠ” ìƒê°ì²­ìì…ë‹ˆë‹¤. ë¹„ì·¨ìƒ‰ì˜ ìœ ì•½ ìœ„ì— í°ìƒ‰ê³¼ ê²€ì€ìƒ‰ìœ¼ë¡œ êµ¬ë¦„ê³¼ í•™ ë¬´ëŠ¬ë¥¼ ìƒê° ê¸°ë²•ìœ¼ë¡œ ì¥ì‹í–ˆìŠµë‹ˆë‹¤.",
        "quiz": {
            "question": "ê³ ë ¤ì²­ìì˜ 'ìƒê° ê¸°ë²•'ì€ ì–´ë–¤ ë°©ì‹ì¼ê¹Œìš”?",
            "options": ["í‘œë©´ì— ê·¸ë¦¼ì„ ê·¸ë¦¬ëŠ” ë°©ì‹", "í‘œë©´ì„ íŒŒë‚¸ í›„ ë‹¤ë¥¸ ìƒ‰ í™ì„ ì±„ì›Œ ë„£ëŠ” ë°©ì‹", "ê¸ˆë°•ì„ ì…íˆëŠ” ë°©ì‹", "ìœ ì•½ì„ ë‘ê»ê²Œ ë°”ë¥´ëŠ” ë°©ì‹"],
            "answer": 1,
            "explanation": "ìƒê° ê¸°ë²•ì€ í‘œë©´ì„ íŒŒë‚¸ í›„ ë‹¤ë¥¸ ìƒ‰ì˜ í™ì„ ì±„ì›Œ ë„£ëŠ” ê¸°ìˆ ë¡œ, ê³ ë ¤ì—ì„œ ë…ìì ìœ¼ë¡œ ë°œì „ì‹œí‚¨ ê¸°ìˆ ì…ë‹ˆë‹¤."
        }
    },

    "í›ˆë¯¼ì •ìŒí•´ë¡€ë³¸": {
        "id": "NMK-005",
        "name": "í›ˆë¯¼ì •ìŒ í•´ë¡€ë³¸",
        "period": "ì¡°ì„  (1446ë…„)",
        "material": "ì¢…ì´ (ëª©íŒ ì¸ì‡„)",
        "location": "ê°„ì†¡ë¯¸ìˆ ê´€",
        "designation": "êµ­ë³´ ì œ70í˜¸",
        "description": "ì„¸ì¢…ëŒ€ì™•ì´ ì°½ì œí•œ í•œê¸€ì˜ ì›ë¦¬ì™€ ì‚¬ìš©ë²•ì„ ì„¤ëª…í•œ ì±…ì…ë‹ˆë‹¤. ì„¸ê³„ì—ì„œ ìœ ì¼í•˜ê²Œ ì°½ì œ ì›ë¦¬ê°€ ë°í˜€ì§„ ë¬¸ìì…ë‹ˆë‹¤.",
        "quiz": {
            "question": "'í›ˆë¯¼ì •ìŒ'ì˜ ëœ»ì€ ë¬´ì—‡ì¼ê¹Œìš”?",
            "options": ["ì„ê¸ˆì´ ë§Œë“  ê¸€ì", "ë°±ì„±ì„ ê°€ë¥´ì¹˜ëŠ” ë°”ë¥¸ ì†Œë¦¬", "ì•„ë¦„ë‹¤ìš´ ìš°ë¦¬ë§", "í•˜ëŠ˜ì´ ë‚´ë¦° ë¬¸ì"],
            "answer": 1,
            "explanation": "'í›ˆë¯¼ì •ìŒ'ì€ 'ë°±ì„±ì„ ê°€ë¥´ì¹˜ëŠ” ë°”ë¥¸ ì†Œë¦¬'ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤."
        }
    },

    "ì²¨ì„±ëŒ€": {
        "id": "NMK-006",
        "name": "ì²¨ì„±ëŒ€",
        "period": "ì‹ ë¼ (7ì„¸ê¸°)",
        "material": "í™”ê°•ì•”",
        "location": "ê²½ì£¼",
        "designation": "êµ­ë³´ ì œ31í˜¸",
        "description": "ì„ ë•ì—¬ì™• ë•Œ ê±´ë¦½ëœ ë™ì–‘ ìµœê³ (æœ€å¤)ì˜ ì²œë¬¸ ê´€ì¸¡ëŒ€ì…ë‹ˆë‹¤. 362ê°œì˜ ëŒë¡œ ìŒ“ì•˜ìœ¼ë©°, ì´ëŠ” ìŒë ¥ 1ë…„ì˜ ë‚ ìˆ˜ë¥¼ ìƒì§•í•©ë‹ˆë‹¤.",
        "quiz": {
            "question": "ì²¨ì„±ëŒ€ëŠ” ëª‡ ê°œì˜ ëŒë¡œ ìŒ“ì•˜ì„ê¹Œìš”?",
            "options": ["100ê°œ", "252ê°œ", "362ê°œ", "500ê°œ"],
            "answer": 2,
            "explanation": "ì²¨ì„±ëŒ€ëŠ” 362ê°œì˜ ëŒë¡œ ìŒ“ì•˜ìœ¼ë©°, ì´ëŠ” ìŒë ¥ 1ë…„ì˜ ë‚ ìˆ˜ë¥¼ ìƒì§•í•©ë‹ˆë‹¤."
        }
    },

    "ì„êµ´ì•”ë³¸ì¡´ë¶ˆìƒ": {
        "id": "NMK-007",
        "name": "ì„êµ´ì•” ë³¸ì¡´ë¶ˆìƒ",
        "period": "í†µì¼ì‹ ë¼ (8ì„¸ê¸°)",
        "material": "í™”ê°•ì•”",
        "location": "ê²½ì£¼ ì„êµ´ì•”",
        "designation": "êµ­ë³´ ì œ24í˜¸",
        "description": "í†µì¼ì‹ ë¼ ë¶ˆêµ ì˜ˆìˆ ì˜ ì •ìˆ˜ë¥¼ ë³´ì—¬ì£¼ëŠ” ì„ê°€ëª¨ë‹ˆë¶ˆ ì¢Œìƒì…ë‹ˆë‹¤. í•­ë§ˆì´‰ì§€ì¸(ë•…ì„ ê°€ë¦¬í‚¤ëŠ” ì† ëª¨ì–‘)ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
        "quiz": {
            "question": "ì„êµ´ì•” ë³¸ì¡´ë¶ˆìƒì´ ì·¨í•˜ê³  ìˆëŠ” 'í•­ë§ˆì´‰ì§€ì¸'ì€ ë¬´ì—‡ì„ ì˜ë¯¸í• ê¹Œìš”?",
            "options": ["ë³µì„ ë‚´ë¦¬ëŠ” ì† ëª¨ì–‘", "ë§ˆê·€ë¥¼ ë¬¼ë¦¬ì¹˜ê³  ê¹¨ë‹¬ìŒì„ ì–»ì€ ìˆœê°„", "ì„¤ë²•í•˜ëŠ” ì† ëª¨ì–‘", "ì¤‘ìƒì„ í’ˆëŠ” ì† ëª¨ì–‘"],
            "answer": 1,
            "explanation": "í•­ë§ˆì´‰ì§€ì¸ì€ ì„ê°€ëª¨ë‹ˆê°€ ë§ˆê·€ì˜ ìœ í˜¹ì„ ë¬¼ë¦¬ì¹˜ê³  ê¹¨ë‹¬ìŒì„ ì–»ì€ ìˆœê°„, ë•…ì˜ ì‹ ì„ ì¦ì¸ìœ¼ë¡œ ì‚¼ëŠ” ì† ëª¨ì–‘ì…ë‹ˆë‹¤."
        }
    },

    "ë‹¤ë³´íƒ‘": {
        "id": "NMK-008",
        "name": "ë‹¤ë³´íƒ‘",
        "period": "í†µì¼ì‹ ë¼ (8ì„¸ê¸°)",
        "material": "í™”ê°•ì•”",
        "location": "ê²½ì£¼ ë¶ˆêµ­ì‚¬",
        "designation": "êµ­ë³´ ì œ20í˜¸",
        "description": "ë¶ˆêµ­ì‚¬ ê²½ë‚´ì— ìˆëŠ” ì„íƒ‘ìœ¼ë¡œ, ë³µì¡í•˜ê³  í™”ë ¤í•œ êµ¬ì¡°ê°€ íŠ¹ì§•ì…ë‹ˆë‹¤. ì„ê°€íƒ‘ê³¼ í•¨ê»˜ ë¶ˆêµ­ì‚¬ë¥¼ ëŒ€í‘œí•˜ëŠ” ì„íƒ‘ì…ë‹ˆë‹¤.",
        "quiz": {
            "question": "ë‹¤ë³´íƒ‘ê³¼ í•¨ê»˜ ë¶ˆêµ­ì‚¬ë¥¼ ëŒ€í‘œí•˜ëŠ” ì„íƒ‘ì˜ ì´ë¦„ì€?",
            "options": ["ì›ê°ì‚¬ì§€ì‹­ì¸µì„íƒ‘", "ì„ê°€íƒ‘", "ë¯¸ë¥µì‚¬ì§€ì„íƒ‘", "ì •ë¦¼ì‚¬ì§€ì˜¤ì¸µì„íƒ‘"],
            "answer": 1,
            "explanation": "ë‹¤ë³´íƒ‘ì€ ì„ê°€íƒ‘ê³¼ í•¨ê»˜ ë¶ˆêµ­ì‚¬ë¥¼ ëŒ€í‘œí•˜ëŠ” ì„íƒ‘ì…ë‹ˆë‹¤. ë‘ íƒ‘ì€ ì„œë¡œ ë‹¤ë¥¸ ì–‘ì‹ìœ¼ë¡œ ëŒ€ë¹„ë¥¼ ì´ë£¹ë‹ˆë‹¤."
        }
    },

    "íŒ”ë§ŒëŒ€ì¥ê²½": {
        "id": "NMK-009",
        "name": "íŒ”ë§ŒëŒ€ì¥ê²½",
        "period": "ê³ ë ¤ (13ì„¸ê¸°)",
        "material": "ëª©íŒ",
        "location": "í•´ì¸ì‚¬ ì¥ê²½íŒì „",
        "designation": "êµ­ë³´ ì œ32í˜¸",
        "description": "ëª½ê³¨ ì¹¨ì…ì„ ë¶€ì²˜ì˜ í˜ìœ¼ë¡œ ë§‰ê³ ì 16ë…„ì— ê±¸ì³ ì œì‘í•œ ëŒ€ì¥ê²½ì…ë‹ˆë‹¤. ì•½ 8ë§Œ ì¥ì˜ ëª©íŒìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.",
        "quiz": {
            "question": "íŒ”ë§ŒëŒ€ì¥ê²½ì´ ë³´ê´€ëœ ì¥ì†ŒëŠ” ì–´ë””ì¼ê¹Œìš”?",
            "options": ["í†µë„ì‚¬", "ë¶ˆêµ­ì‚¬", "í•´ì¸ì‚¬", "ì†¡ê´‘ì‚¬"],
            "answer": 2,
            "explanation": "íŒ”ë§ŒëŒ€ì¥ê²½ì€ í•´ì¸ì‚¬ ì¥ê²½íŒì „ì— ë³´ê´€ë˜ì–´ ìˆìœ¼ë©°, ì¥ê²½íŒì „ì˜ ê³¼í•™ì ì¸ í™˜ê¸° ì‹œìŠ¤í…œ ë•ë¶„ì— 800ë…„ê°„ ë³´ì¡´ë˜ì—ˆìŠµë‹ˆë‹¤."
        }
    },

    "ë¬´ë ¹ì™•ë¦‰ê¸ˆê´€ì‹": {
        "id": "NMK-010",
        "name": "ë¬´ë ¹ì™•ë¦‰ ê¸ˆê´€ì‹",
        "period": "ë°±ì œ (6ì„¸ê¸°)",
        "material": "ê¸ˆ",
        "location": "êµ­ë¦½ê³µì£¼ë°•ë¬¼ê´€",
        "designation": "êµ­ë³´ ì œ154í˜¸",
        "description": "ë¬´ë ¹ì™•ë¦‰ì—ì„œ ì¶œí† ëœ ì™•ê³¼ ì™•ë¹„ì˜ ê¸ˆê´€ ì¥ì‹ì…ë‹ˆë‹¤. ë¶ˆê½ƒ ëª¨ì–‘ì˜ í™”ë ¤í•œ ë””ìì¸ì´ íŠ¹ì§•ì…ë‹ˆë‹¤.",
        "quiz": {
            "question": "ë¬´ë ¹ì™•ë¦‰ ê¸ˆê´€ì‹ì˜ íŠ¹ì§•ì ì¸ ë””ìì¸ ëª¨ì–‘ì€?",
            "options": ["ê½ƒ ëª¨ì–‘", "ë¶ˆê½ƒ ëª¨ì–‘", "ë‚˜ë¹„ ëª¨ì–‘", "ìƒˆ ëª¨ì–‘"],
            "answer": 1,
            "explanation": "ë¬´ë ¹ì™•ë¦‰ ê¸ˆê´€ì‹ì€ ë¶ˆê½ƒ ëª¨ì–‘ì˜ í™”ë ¤í•œ ë””ìì¸ì´ íŠ¹ì§•ì´ë©°, ë°±ì œì˜ ë›°ì–´ë‚œ ê¸ˆì† ê³µì˜ˆ ê¸°ìˆ ì„ ë³´ì—¬ì¤ë‹ˆë‹¤."
        }
    },

    "ì²œë§ˆì´ê¸ˆê´€": {
        "id": "NMK-011",
        "name": "ì²œë§ˆì´ ê¸ˆê´€",
        "period": "ì‹ ë¼ (5-6ì„¸ê¸°)",
        "material": "ê¸ˆ, ì˜¥",
        "location": "êµ­ë¦½ê²½ì£¼ë°•ë¬¼ê´€",
        "designation": "êµ­ë³´ ì œ188í˜¸",
        "description": "ê²½ì£¼ ì²œë§ˆì´ì—ì„œ ì¶œí† ëœ ì‹ ë¼ ê¸ˆê´€ì…ë‹ˆë‹¤. ì²œë§ˆë„ê°€ ê·¸ë ¤ì§„ ì¥ë‹ˆì™€ í•¨ê»˜ ë°œê²¬ë˜ì–´ ì²œë§ˆì´ì´ë¼ëŠ” ì´ë¦„ì´ ë¶™ì—ˆìŠµë‹ˆë‹¤.",
        "quiz": {
            "question": "ì²œë§ˆì´ì´ë¼ëŠ” ì´ë¦„ì€ ë¬´ì—‡ ë•Œë¬¸ì— ë¶™ì—¬ì¡Œì„ê¹Œìš”?",
            "options": ["í•˜ëŠ˜ì„ ë‚˜ëŠ” ë§ ì¡°ê°ì´ ìˆì–´ì„œ", "ì²œë§ˆë„ê°€ ê·¸ë ¤ì§„ ì¥ë‹ˆê°€ ë°œê²¬ë˜ì–´ì„œ", "ë§ ëª¨ì–‘ì˜ ê¸ˆê´€ì´ ì¶œí† ë˜ì–´ì„œ", "ì²œ ë§ˆë¦¬ì˜ ë§ì´ ë¶€ì¥ë˜ì–´ì„œ"],
            "answer": 1,
            "explanation": "ì²œë§ˆë„(í•˜ëŠ˜ì„ ë‚˜ëŠ” ë§ ê·¸ë¦¼)ê°€ ê·¸ë ¤ì§„ ì¥ë‹ˆ(ë§ ì•ˆì¥ ì–‘ì˜† ê°€ë¦¬ê°œ)ê°€ ë°œê²¬ë˜ì–´ ì²œë§ˆì´ì´ë¼ëŠ” ì´ë¦„ì´ ë¶™ì—ˆìŠµë‹ˆë‹¤."
        }
    },

    "ì—ë°€ë ˆì¢…": {
        "id": "NMK-012",
        "name": "ì„±ë•ëŒ€ì™•ì‹ ì¢… (ì—ë°€ë ˆì¢…)",
        "period": "í†µì¼ì‹ ë¼ (771ë…„)",
        "material": "ì²­ë™",
        "location": "êµ­ë¦½ê²½ì£¼ë°•ë¬¼ê´€",
        "designation": "êµ­ë³´ ì œ29í˜¸",
        "description": "í˜„ì¡´í•˜ëŠ” í•œêµ­ ìµœëŒ€ì˜ ë™ì¢…ì…ë‹ˆë‹¤. ì•„ë¦„ë‹¤ìš´ ì†Œë¦¬ì™€ ë¹„ì²œìƒ ì¡°ê°ìœ¼ë¡œ ìœ ëª…í•˜ë©°, ì—ë°€ë ˆì¢…ì´ë¼ëŠ” ë³„ëª…ìœ¼ë¡œë„ ë¶ˆë¦½ë‹ˆë‹¤.",
        "quiz": {
            "question": "ì„±ë•ëŒ€ì™•ì‹ ì¢…ì˜ ë³„ëª… 'ì—ë°€ë ˆì¢…'ì€ ë¬´ìŠ¨ ëœ»ì¼ê¹Œìš”?",
            "options": ["ì–´ë¨¸ë‹ˆ ì¢…", "ì„ê¸ˆë‹˜ ì¢…", "í•˜ëŠ˜ ì¢…", "í™©ê¸ˆ ì¢…"],
            "answer": 0,
            "explanation": "ì—ë°€ë ˆëŠ” 'ì–´ë¨¸ë‹ˆ'ë¼ëŠ” ëœ»ì˜ ì˜›ë§ì…ë‹ˆë‹¤. ì¢…ì†Œë¦¬ê°€ 'ì—ë°€ë ˆ~'ì²˜ëŸ¼ ë“¤ë¦°ë‹¤ëŠ” ì „ì„¤ì—ì„œ ìœ ë˜í–ˆìŠµë‹ˆë‹¤."
        }
    },

    "ìµì‚°ë¯¸ë¥µì‚¬ì§€ì„íƒ‘": {
        "id": "NMK-013",
        "name": "ìµì‚° ë¯¸ë¥µì‚¬ì§€ ì„íƒ‘",
        "period": "ë°±ì œ (7ì„¸ê¸°)",
        "material": "í™”ê°•ì•”",
        "location": "ì „ë¶ ìµì‚°",
        "designation": "êµ­ë³´ ì œ11í˜¸",
        "description": "í•œêµ­ì—ì„œ ê°€ì¥ í¬ê³  ì˜¤ë˜ëœ ì„íƒ‘ì…ë‹ˆë‹¤. ëª©íƒ‘ ì–‘ì‹ì„ ì„íƒ‘ìœ¼ë¡œ ì˜®ê¸´ í˜•íƒœë¡œ, ë°±ì œ ì„íƒ‘ì˜ ì‹œì›ìœ¼ë¡œ í‰ê°€ë©ë‹ˆë‹¤.",
        "quiz": {
            "question": "ìµì‚° ë¯¸ë¥µì‚¬ì§€ ì„íƒ‘ì˜ ì—­ì‚¬ì  ì˜ì˜ëŠ”?",
            "options": ["ê°€ì¥ í™”ë ¤í•œ ì„íƒ‘", "í•œêµ­ì—ì„œ ê°€ì¥ í¬ê³  ì˜¤ë˜ëœ ì„íƒ‘", "ê°€ì¥ ì‘ì€ ì„íƒ‘", "ìœ ì¼í•œ ê¸ˆë™ ì„íƒ‘"],
            "answer": 1,
            "explanation": "ìµì‚° ë¯¸ë¥µì‚¬ì§€ ì„íƒ‘ì€ í•œêµ­ì—ì„œ ê°€ì¥ í¬ê³  ì˜¤ë˜ëœ ì„íƒ‘ìœ¼ë¡œ, ëª©íƒ‘ ì–‘ì‹ì„ ì„íƒ‘ìœ¼ë¡œ ì˜®ê¸´ í˜•íƒœì…ë‹ˆë‹¤."
        }
    },

    "ê¸ˆë™ì—°ê°€ì¹ ë…„ëª…ì—¬ë˜ì…ìƒ": {
        "id": "NMK-014",
        "name": "ê¸ˆë™ì—°ê°€7ë…„ëª…ì—¬ë˜ì…ìƒ",
        "period": "ê³ êµ¬ë ¤ (539ë…„)",
        "material": "ê¸ˆë™",
        "location": "êµ­ë¦½ì¤‘ì•™ë°•ë¬¼ê´€",
        "designation": "êµ­ë³´ ì œ119í˜¸",
        "description": "ê³ êµ¬ë ¤ ë¶ˆìƒ ì¤‘ ìœ ì¼í•˜ê²Œ ì œì‘ ì—°ë„ê°€ ìƒˆê²¨ì§„ ë¶ˆìƒì…ë‹ˆë‹¤. ì—°ê°€ 7ë…„(539ë…„)ì´ë¼ëŠ” ëª…ë¬¸ì´ ìˆì–´ ê³ êµ¬ë ¤ ë¶ˆêµ ë¯¸ìˆ  ì—°êµ¬ì— ì¤‘ìš”í•©ë‹ˆë‹¤.",
        "quiz": {
            "question": "ê¸ˆë™ì—°ê°€7ë…„ëª…ì—¬ë˜ì…ìƒì´ íŠ¹ë³„í•œ ì´ìœ ëŠ”?",
            "options": ["ê°€ì¥ í° ë¶ˆìƒì´ì–´ì„œ", "ì œì‘ ì—°ë„ê°€ ìƒˆê²¨ì§„ ìœ ì¼í•œ ê³ êµ¬ë ¤ ë¶ˆìƒì´ì–´ì„œ", "ê¸ˆìœ¼ë¡œë§Œ ë§Œë“¤ì–´ì ¸ì„œ", "ì—¬ì™•ì´ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì—"],
            "answer": 1,
            "explanation": "ì´ ë¶ˆìƒì€ 'ì—°ê°€ 7ë…„(539ë…„)'ì´ë¼ëŠ” ëª…ë¬¸ì´ ìƒˆê²¨ì§„ ê³ êµ¬ë ¤ ìœ ì¼ì˜ ë¶ˆìƒìœ¼ë¡œ, ê³ êµ¬ë ¤ ë¶ˆêµ ë¯¸ìˆ  ì—°êµ¬ì— ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤."
        }
    },

    "ê²½ì²œì‚¬ì‹­ì¸µì„íƒ‘": {
        "id": "NMK-015",
        "name": "ê²½ì²œì‚¬ ì‹­ì¸µì„íƒ‘",
        "period": "ê³ ë ¤ (1348ë…„)",
        "material": "ëŒ€ë¦¬ì„",
        "location": "êµ­ë¦½ì¤‘ì•™ë°•ë¬¼ê´€",
        "designation": "êµ­ë³´ ì œ86í˜¸",
        "description": "ì›ë‚˜ë¼ì˜ ì˜í–¥ì„ ë°›ì€ ê³ ë ¤ í›„ê¸°ì˜ ì„íƒ‘ì…ë‹ˆë‹¤. ëŒ€ë¦¬ì„ìœ¼ë¡œ ë§Œë“¤ì–´ì¡Œìœ¼ë©°, í™”ë ¤í•œ ì¡°ê°ì´ íŠ¹ì§•ì…ë‹ˆë‹¤. ì¼ì œê°•ì ê¸°ì— ì¼ë³¸ìœ¼ë¡œ ë°˜ì¶œë˜ì—ˆë‹¤ê°€ ë°˜í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.",
        "quiz": {
            "question": "ê²½ì²œì‚¬ ì‹­ì¸µì„íƒ‘ì˜ ì¬ë£ŒëŠ” ë¬´ì—‡ì¼ê¹Œìš”?",
            "options": ["í™”ê°•ì•”", "ëŒ€ë¦¬ì„", "ì‚¬ì•”", "í˜„ë¬´ì•”"],
            "answer": 1,
            "explanation": "ê²½ì²œì‚¬ ì‹­ì¸µì„íƒ‘ì€ ëŒ€ë¦¬ì„ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ì„íƒ‘ìœ¼ë¡œ, ê³ ë ¤ í›„ê¸° ì›ë‚˜ë¼ì˜ ì˜í–¥ì„ ë°›ì€ ì–‘ì‹ì…ë‹ˆë‹¤."
        }
    }
}


# ============================================================
# ğŸ” ìœ ë¬¼ ê²€ìƒ‰ í•¨ìˆ˜
# ============================================================

def find_artifact(text: str) -> dict | None:
    """í…ìŠ¤íŠ¸ì—ì„œ ìœ ë¬¼ì„ ì°¾ìŠµë‹ˆë‹¤."""
    if not text:
        return None

    for key, artifact in ARTIFACTS.items():
        if key in text or artifact["name"] in text:
            return artifact

    return None


def get_artifact_list() -> list:
    """ìœ ë¬¼ ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤."""
    return list(ARTIFACTS.keys())


def get_artifact_by_id(artifact_id: str) -> dict | None:
    """IDë¡œ ìœ ë¬¼ì„ ì°¾ìŠµë‹ˆë‹¤."""
    for artifact in ARTIFACTS.values():
        if artifact.get("id") == artifact_id:
            return artifact
    return None


def get_random_artifacts(count: int = 10, use_api: bool = False) -> list:
    """
    ëœë¤ìœ¼ë¡œ ìœ ë¬¼ì„ ì„ íƒí•©ë‹ˆë‹¤.

    Parameters:
        count: ê°€ì ¸ì˜¬ ìœ ë¬¼ ê°œìˆ˜
        use_api: API ì‚¬ìš© ì—¬ë¶€ (ê¸°ë³¸ False - JSON ë°ì´í„° ì‚¬ìš©)

    Returns:
        list: ìœ ë¬¼ ëª©ë¡
    """
    # APIì—ì„œ ê°€ì ¸ì˜¤ê¸° ì‹œë„ (ë¹„í™œì„±í™”ë¨)
    if use_api:
        api_artifacts = fetch_artifacts_from_api(count=count)
        if api_artifacts:
            # API ìœ ë¬¼ì— í€´ì¦ˆ ìƒì„±
            return _add_quizzes_to_artifacts(api_artifacts)

    # ê¸°ë³¸: í•˜ë“œì½”ë”©ëœ ë°ì´í„° ì‚¬ìš©
    print("ğŸ“š ê¸°ë³¸ ìœ ë¬¼ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.")
    keys = list(ARTIFACTS.keys())
    selected = random.sample(keys, min(count, len(keys)))
    return [ARTIFACTS[key] for key in selected]


def _add_quizzes_to_artifacts(artifacts: list) -> list:
    """
    APIì—ì„œ ê°€ì ¸ì˜¨ ìœ ë¬¼ì— í€´ì¦ˆ ì¶”ê°€

    Gemini APIë¡œ í€´ì¦ˆë¥¼ ìƒì„±í•˜ê±°ë‚˜ ê¸°ë³¸ í€´ì¦ˆ ì‚¬ìš©
    """
    for artifact in artifacts:
        if artifact.get("quiz") is None:
            artifact["quiz"] = _generate_quiz_for_artifact(artifact)
    return artifacts


def _generate_quiz_for_artifact(artifact: dict) -> dict:
    """
    ìœ ë¬¼ì— ëŒ€í•œ í€´ì¦ˆ ìƒì„±

    Gemini API ì‚¬ìš© ê°€ëŠ¥í•˜ë©´ AI ìƒì„±, ì•„ë‹ˆë©´ ê¸°ë³¸ í€´ì¦ˆ
    """
    try:
        from services.llm_service import LLMService
        import os

        api_key = os.getenv("GEMINI_API_KEY", "")
        if api_key:
            llm = LLMService(api_key)
            if llm.model:
                return _generate_quiz_with_gemini(llm, artifact)
    except Exception as e:
        print(f"í€´ì¦ˆ ìƒì„± ì˜¤ë¥˜: {e}")

    # ê¸°ë³¸ í€´ì¦ˆ
    return _create_default_quiz(artifact)


def _generate_quiz_with_gemini(llm, artifact: dict) -> dict:
    """Gemini APIë¡œ í€´ì¦ˆ ìƒì„±"""
    import json
    import re

    prompt = f"""ë‹¤ìŒ ìœ ë¬¼ì— ëŒ€í•œ 4ì§€ì„ ë‹¤ í€´ì¦ˆë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.

ìœ ë¬¼ ì •ë³´:
- ì´ë¦„: {artifact.get('name', 'ì•Œ ìˆ˜ ì—†ìŒ')}
- ì‹œëŒ€: {artifact.get('period', 'ì‹œëŒ€ ë¯¸ìƒ')}
- ì¬ì§ˆ: {artifact.get('material', '')}
- ì„¤ëª…: {artifact.get('description', '')}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì •í™•íˆ ì‘ë‹µí•´ì£¼ì„¸ìš”:
{{
    "question": "í€´ì¦ˆ ì§ˆë¬¸",
    "options": ["ì„ íƒì§€1", "ì„ íƒì§€2", "ì„ íƒì§€3", "ì„ íƒì§€4"],
    "answer": 0,
    "explanation": "ì •ë‹µ í•´ì„¤"
}}

ì£¼ì˜:
- answerëŠ” ì •ë‹µì˜ ì¸ë±ìŠ¤ (0-3)
- ì§ˆë¬¸ì€ ìœ ë¬¼ì˜ íŠ¹ì§•ì´ë‚˜ ì—­ì‚¬ì  ì˜ì˜ì— ê´€í•œ ê²ƒ
- ì„ íƒì§€ëŠ” ë¹„ìŠ·í•´ ë³´ì´ì§€ë§Œ ëª…í™•íˆ êµ¬ë¶„ë˜ì–´ì•¼ í•¨
"""

    try:
        response = llm.model.generate_content(prompt)
        response_text = response.text

        # JSON ì¶”ì¶œ
        json_match = re.search(r'\{.*\}', response_text, re.DOTALL)
        if json_match:
            quiz = json.loads(json_match.group())
            # í•„ìˆ˜ í•„ë“œ í™•ì¸
            if all(k in quiz for k in ["question", "options", "answer", "explanation"]):
                return quiz
    except Exception as e:
        print(f"Gemini í€´ì¦ˆ ìƒì„± ì‹¤íŒ¨: {e}")

    return _create_default_quiz(artifact)


def _create_default_quiz(artifact: dict) -> dict:
    """ê¸°ë³¸ í€´ì¦ˆ ìƒì„±"""
    name = artifact.get('name', 'ì´ ìœ ë¬¼')
    period = artifact.get('period', 'ì‹œëŒ€ ë¯¸ìƒ')

    return {
        "question": f"'{name}'ì€(ëŠ”) ì–´ëŠ ì‹œëŒ€ì˜ ìœ ë¬¼ì¼ê¹Œìš”?",
        "options": ["ì‚¼êµ­ì‹œëŒ€", "ê³ ë ¤ì‹œëŒ€", "ì¡°ì„ ì‹œëŒ€", "ê·¼í˜„ëŒ€"],
        "answer": 0,
        "explanation": f"ì´ ìœ ë¬¼ì€ {period}ì— ì œì‘ëœ ê²ƒìœ¼ë¡œ ì•Œë ¤ì ¸ ìˆìŠµë‹ˆë‹¤."
    }
